<%= render 'shared/alt_header' %>
<%= render 'shared/alt_static' %>

<% if @user.role.nil? %>

<div class="without_role">
  <div class="user_form">
    <%= form_for @user, url: update_role_path do |f| %>
      <p>I am a:
          <%= f.radio_button :role, 'professional' %>
          <%= f.label :role_volunteer, 'Professional' %>
          <%= f.radio_button :role, 'npo' %>
          <%= f.label :role_npo, 'Non-Profit Organization' %>
      </p>
      <p>
          <%= f.submit 'Set my role' %>
      </p>
    <% end %>
  </div>
</div>

<% else %>

<div class="with_role">
  <div class="greeting_message">
    <p>
        Hi <%= @user.email %>, you are registered as a 

        <% if @user.role == 'npo' %>
        non-profit
        <% elsif @user.role == 'professional' %>
        professional
        <% end %>
        . In this page, you can view your your applications and past projects.
    </p>
  </div>
  <div class="profile_view_nav">
      <ul class="profile_view_nav_buttons">   
          <li>
              <div class='profile_view_button' id='summary'>Summary</div>
          </li>
          <li>
              <div class='profile_view_button' id='applications' data-readapp = '<%= read_applications_path %>'>Applications
                <div class="notification_count <%= "hidden" if @notification_count == 0 %>"><%= @notification_count %></div>
              </div>
          </li>
          <li>
              <div class='profile_view_button' id='projects'>Projects</div>              
          </li>

          <% if @user.role == 'professional' %>
              <li>                  
                  <div class='profile_view_button' id='shortlist'>Shortlisted projects</div>                  
              </li>
          <% end %>

          <% if @user.role == 'npo' %>

              <li>
                <div class="profile_view_button" id="add-new">Add new project</div>
              </li>

          <% end %>

          <li>
            
            <div class='profile_view_button' id='settings'>Settings</div>

          </li>

      </ul>

  </div>
  <div class="profile_view">
      <div class="profile_view_content" id='summary'>
        <% if @user.role == 'professional' %>
        <div class="points">
          <p><%= "You have completed #{pluralize(@number_ccompleted_applications, 'project')} to date and earned #{pluralize(@points, 'point')}." %></p>
        </div>
        <% elsif @user.role == 'npo' %>
          <h1>Average views per project for the past weeks:</h1>
          <%= column_chart @average_view_per_project_by_week %>
          <h1>Average time (seconds) for each project view:</h1>
          <%= column_chart @average_view_time_by_week %>
          <!-- ProjectView.group(:project_id).count -->
        <% end %>
      </div>

      <div class="profile_view_content" id='projects'>
          <h1>Projects</h1>
          <% if @user.role == 'npo' %>
            <%= render partial: 'projects/project', collection: @projects %>
          <% elsif @user.role == 'professional' %>
            <%= render partial: 'applications/application', collection: @completed_applications, locals: {role: @role} %>
          <% end %>
      </div>

      <div class="profile_view_content" id='applications'>
          <h1>Applications</h1>
          <%= render partial: 'applications/application', collection: @applications, locals: {role: @role} %>
      </div>
      
      <% if @user.role == 'professional' %>
        <div class="profile_view_content" id='shortlist'>
            <div id="error_messages">
            </div>
            <h1>Shortlist</h1>
            <%= render partial: 'applications/application', collection: @shortlists, locals: {role: @role} %>
        </div>
      <% end %>
      
      <% if @user.role == 'npo' %>
        <% @project = Project.new %>
        <div class="profile_view_content" id="add-new">
          <h3>New Project</h3>
          <%= render 'projects/form' %>
        </div>
      <% end %>

      <div class="profile_view_content" id='settings'>
        <h1>Settings</h1>
        <% if @user.role == 'professional' %>
          <div class='project_view_filter_setting'>
            <%= form_for @user do |f| %>
              <p>Category</p>
              <%= collection_check_boxes(:user, :category_ids, Category.all, :id, :category) %>
               
              <p>Cause</p>
              <%= collection_check_boxes(:user, :cause_ids, Cause.all, :id, :cause) %>

              <p>Location</p>
              <%= collection_check_boxes(:user, :location_ids, Location.all, :id, :location) %>
              <%= f.submit %>
            <% end %>
          </div>
          <div class="upload_container">
            <%= render partial: 'resume_upload', locals: {user: @user} %>
          </div>
        <% elsif @user.role == 'npo' %>
          <div class="upload_container">
            <%= render partial: 'logo_upload', locals: {user: @user} %>
          </div>
        <% end %>

      </div>

  </div>

  <div>


</div>

<% end %>